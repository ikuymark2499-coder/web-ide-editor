<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevStudio Gold - AI Core</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .code-font { font-family: 'Fira Code', monospace; }
        .editor-container { height: calc(100vh - 120px); }
        .loader {
            width: 24px; height: 24px; border: 3px solid #3b82f6;
            border-bottom-color: transparent; border-radius: 50%;
            display: inline-block; animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="h-14 border-b border-[#30363d] bg-[#161b22] flex items-center justify-between px-6">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold text-white italic">G</div>
            <span class="font-bold text-white">DEVSTUDIO <span class="text-blue-500 font-black">GOLD</span></span>
        </div>
        <div class="flex gap-2">
            <button id="run-btn" onclick="runCode()" class="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-1.5 rounded-lg text-xs font-bold transition-all">
                â–¶ RUN PREVIEW
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 border-r border-[#30363d] p-4 hidden md:block">
            <h3 class="text-[10px] font-black text-gray-500 uppercase tracking-widest mb-4">Project Files</h3>
            <div id="file-list" class="space-y-1"></div>
        </aside>

        <!-- Editor -->
        <div class="flex-1 flex flex-col relative">
            <div class="h-8 bg-[#0d1117] flex items-center px-4 border-b border-[#30363d]">
                <span id="active-filename" class="text-[10px] text-blue-400 font-bold italic">No file selected</span>
            </div>
            <textarea id="editor" class="flex-1 p-6 bg-transparent text-white code-font text-sm outline-none resize-none" spellcheck="false" placeholder="// Describe your project in the AI Chat below..."></textarea>
        </div>
    </main>

    <!-- AI Chat Console (Sticky Bottom) -->
    <div class="bg-[#161b22] border-t border-[#30363d] p-4 shadow-2xl">
        <div class="max-w-4xl mx-auto flex gap-3">
            <div class="flex-1 relative">
                <input type="text" id="ai-prompt" placeholder="à¹€à¸Šà¹ˆà¸™ 'à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸š Portfolio à¸ªà¸§à¸¢à¹† à¸¡à¸µà¹à¸­à¸™à¸´à¹€à¸¡à¸Šà¸±à¹ˆà¸™à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢'..." 
                    class="w-full bg-[#0d1117] border border-[#30363d] p-3 pl-4 rounded-xl text-sm outline-none focus:border-blue-500 transition-all text-white">
                <div id="ai-status" class="absolute right-3 top-3 hidden">
                    <span class="loader"></span>
                </div>
            </div>
            <button id="gen-btn" onclick="generateCode()" class="bg-blue-600 hover:bg-blue-500 text-white px-8 rounded-xl font-bold text-sm transition-all shadow-lg shadow-blue-900/20">
                GENERATE
            </button>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="fixed inset-0 bg-white z-[1000] hidden flex-col">
        <div class="h-12 bg-gray-900 flex items-center justify-between px-6">
            <span class="text-xs font-bold text-gray-400">LIVE PREVIEW</span>
            <button onclick="closePreview()" class="bg-red-500 text-white px-4 py-1 rounded-full text-[10px] font-bold">EXIT</button>
        </div>
        <iframe id="preview-frame" class="w-full flex-1 border-none"></iframe>
    </div>

    <script>
        const apiKey = ""; // 
        let currentCode = "";
        let files = JSON.parse(localStorage.getItem('devstudio_files')) || [];

        // --- AI LOGIC ---
        async function generateCode() {
            const prompt = document.getElementById('ai-prompt').value.trim();
            const genBtn = document.getElementById('gen-btn');
            const statusIcon = document.getElementById('ai-status');

            if (!prompt) return;

            genBtn.disabled = true;
            statusIcon.classList.remove('hidden');
            genBtn.textContent = "AI WORKING...";

            const systemInstruction = `You are a professional full-stack web developer. 
            Instruction: Generate a single file HTML/CSS/JS code based on user prompt.
            Format: Return ONLY the code. Do not use markdown backticks (\`\`\`html). 
            Style: Modern, mobile-responsive, use Tailwind CSS CDN for styling.`;

            try {
                // THE STABLE CALL METHOD FOR THIS ENVIRONMENT
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || "Connection failed");
                }

                const data = await response.json();
                let code = data.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!code) throw new Error("AI returned empty result");

                // Clean the code output
                code = code.replace(/^```[a-z]*\n/gi, '').replace(/\n```$/g, '').trim();

                // Update UI
                document.getElementById('editor').value = code;
                document.getElementById('active-filename').textContent = "generated_index.html";
                
                // Save to local storage
                const newFile = { id: Date.now(), name: "App_" + Date.now() + ".html", content: code };
                files.unshift(newFile);
                localStorage.setItem('devstudio_files', JSON.stringify(files));
                
                renderFiles();
                alert("âœ¨ à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹‰à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ! à¸„à¸¸à¸“à¸ªà¸²à¸¡à¸²à¸£à¸–à¸à¸” RUN à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸œà¸¥à¸¥à¸±à¸žà¸˜à¹Œà¹„à¸”à¹‰à¸—à¸±à¸™à¸—à¸µ");

            } catch (err) {
                console.error(err);
                alert("âŒ à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸¥à¹‰à¸¡à¹€à¸«à¸¥à¸§: " + err.message + "\n\nà¸„à¸³à¹à¸™à¸°à¸™à¸³: à¸£à¸°à¸šà¸šà¸­à¸²à¸ˆà¸à¸³à¸¥à¸±à¸‡à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡ API à¹à¸™à¸°à¸™à¸³à¹ƒà¸«à¹‰à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸„à¸¸à¸“à¹„à¸”à¹‰à¸à¸”à¸£à¸±à¸™à¹ƒà¸™à¹‚à¸«à¸¡à¸” Preview à¸‚à¸­à¸‡à¹à¸žà¸¥à¸•à¸Ÿà¸­à¸£à¹Œà¸¡à¸™à¸µà¹‰");
            } finally {
                genBtn.disabled = false;
                statusIcon.classList.add('hidden');
                genBtn.textContent = "GENERATE";
                document.getElementById('ai-prompt').value = "";
            }
        }

        // --- UTILS ---
        function renderFiles() {
            const list = document.getElementById('file-list');
            list.innerHTML = '';
            files.forEach(file => {
                const item = document.createElement('div');
                item.className = "flex items-center justify-between p-2 rounded hover:bg-[#1c2128] cursor-pointer text-xs";
                item.innerHTML = `<span onclick="loadFile(${file.id})">ðŸ“„ ${file.name}</span> <button onclick="deleteFile(${file.id})" class="text-gray-600 hover:text-red-500">âœ•</button>`;
                list.appendChild(item);
            });
        }

        function loadFile(id) {
            const file = files.find(f => f.id === id);
            if (file) {
                document.getElementById('editor').value = file.content;
                document.getElementById('active-filename').textContent = file.name;
            }
        }

        function deleteFile(id) {
            files = files.filter(f => f.id !== id);
            localStorage.setItem('devstudio_files', JSON.stringify(files));
            renderFiles();
        }

        function runCode() {
            const code = document.getElementById('editor').value;
            if (!code) return alert("à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹‚à¸„à¹‰à¸”à¹ƒà¸«à¹‰à¸£à¸±à¸™à¸„à¸£à¸±à¸š");
            
            const frame = document.getElementById('preview-frame');
            const blob = new Blob([code], { type: 'text/html' });
            frame.src = URL.createObjectURL(blob);
            document.getElementById('preview-modal').classList.replace('hidden', 'flex');
        }

        function closePreview() {
            document.getElementById('preview-modal').classList.replace('flex', 'hidden');
        }

        // Initial Load
        renderFiles();
    </script>
</body>
</html>
